# 株式評価損益計算ツール

このスクリプトは、売買シグナルに基づいて株式を売買した場合の評価損益を計算するためのツールです。yfinanceを使用して株価データを取得し、指定された日付の翌営業日から最新日までの評価損益を計算します。

## 機能

- 指定した日付の翌営業日の株価と最新の株価を比較して評価損益を算出
- 複数の売買シグナルファイル形式に対応（buy/sell/range_break）
- 詳細な評価結果とサマリー情報を別々のCSVファイルに出力
- 買いシグナルと売りシグナルの正解率を自動判定
- 処理状況の詳細なコンソール表示

## 必要条件

- Python 3.6以上
- 必要なパッケージ：
  - pandas
  - yfinance
  - datetime
  - glob
  - pathlib
  - time
  - re

## インストール方法

1. 必要なパッケージをインストールします：

```bash
pip install pandas yfinance
```

2. スクリプトをダウンロードして任意のフォルダに配置します。

## 使用方法

1. スクリプトと同じフォルダに「InputData」フォルダを作成し、評価したいCSVファイルを配置します。
2. スクリプトと同じフォルダに「Output」フォルダを作成します（存在しない場合は自動作成されます）。
3. コマンドラインからスクリプトを実行します：

```bash
python stock_evaluation.py 20240501
```

※「20240501」の部分には、評価したい日付をyyyymmdd形式で指定します。

## 入力ファイル形式

以下のような形式のCSVファイルに対応しています：

1. 買いシグナル：`macd_rci_signal_result_buy.csv`
2. 売りシグナル：`macd_rci_signal_result_sell.csv`
3. ブレイク：`range_break.csv` または `Range_Brake.csv` または `Breakout.csv`

CSVファイルは少なくとも以下の列を含む必要があります：
- Ticker：銘柄コード
- Company：会社名

## 出力ファイル

スクリプトは入力ファイルごとに2種類のファイルを出力します：

1. 詳細評価結果：`{入力ファイル名}_eval.csv`
   - Ticker：銘柄コード
   - Company：会社名
   - 評価額：最新のClose値 - 翌営業日のOpen値
   - 評価損益率(%)：（評価額 ÷ 翌営業日のOpen値）× 100
   - 売買の日：入力された日付（yyyymmdd）
   - 翌営業日のOpen値
   - 最新データの取得日（yyyymmdd）
   - 最新のClose値

2. サマリー情報：`summary_{指標タイプ}_{シグナルタイプ}.csv`
   - 合計評価額：全銘柄の評価額の合計
   - 合計評価損益率(%)：全体の評価損益率
   - シグナル正解率(%)：シグナルの正解率
     - 買いシグナルの場合：評価額がプラスの銘柄の割合
     - 売りシグナルの場合：評価額がマイナスの銘柄の割合
   - 全体銘柄数：処理された銘柄の総数
   - 正解銘柄数：正解と判定された銘柄の数

## 特別なケース

- `range_break.csv` または `Range_Brake.csv` または `Breakout.csv` の場合、出力ファイル名は統一して `breakout_eval.csv` と `summary_breakout.csv` になります。
- 買いシグナルはプラスになることが正解、売りシグナルはマイナスになることが正解として判定されます。

## コンソール出力

スクリプト実行中は、以下のような情報がコンソールに表示されます：

- 処理開始と終了の通知
- 入力ファイルと出力ファイルのパス
- 各ファイルの処理状況
- 各銘柄の処理状況と結果
- 評価結果とサマリー情報
- 処理時間

## 注意事項

- 日本株の場合、ティッカーシンボルに自動的に「.T」が追加されます（4桁の数字の場合）
- 土日は翌営業日として扱われます（土曜日→月曜日、日曜日→月曜日）
- APIリクエスト制限を考慮して、各銘柄の処理間に短い待機時間が入ります
- 祝日は考慮されていません。必要に応じて休日データを追加してください

## エラー処理

- ファイルが見つからない場合や処理中にエラーが発生した場合は、適切なエラーメッセージが表示されます
- 個別の銘柄の処理でエラーが発生した場合も、他の銘柄の処理は継続されます

## ライセンス

このスクリプトは自由に利用、改変、再配布可能です。